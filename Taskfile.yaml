# yaml-language-server: $schema=https://json.schemastore.org/taskfile.json
---
version: "3"

env:
  PROFILE: home

tasks:
  default:
    desc: Show help
    aliases: [h]
    silent: true
    cmds:
      - task -l

  install:
    desc: Install files with dotbot
    aliases: [i]
    cmds:
      - ./install

  brew:save:
    desc: Save installed brews
    aliases: [bs]
    cmds:
      - brew leaves > brew/Brewfile.${PROFILE}

  brew:install:
    desc: Install brew apps
    aliases: [bi]
    cmds:
      - brew install $(cat brew/Brewfile)

  vscode:extensions:save:
    desc: Save vscode extensions to save on another pc
    aliases: [ves]
    cmds:
      - code --list-extensions > vscode/extensions.${PROFILE}.txt

  vscode:extensions:install:
    desc: Install vscode extensions
    aliases: [vei]
    cmds:
      - awk '{ printf "code --install-extension %s\n", $1 }' "vscode/extensions.txt" | bash

  nodejs:save:
    desc: Save global installs
    aliases: [ns]
    cmds:
      - npm list -g --depth=0 -json > nodejs/globals.${PROFILE}.json

  install:all:
    desc: Install all (synlinks, brew, vscode extensions)
    aliases: [ia]
    cmds:
      # run sequencialy
      - task: install
      - task: brew:install
      - task: vscode:extensions:install

  save:all:
    desc: Save current config
    aliases: [sa]
    deps:
      # run in parallel
      - brew:save
      - vscode:extensions:save
      - nodejs:save
